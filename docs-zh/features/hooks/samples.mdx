---
title: "ç¤ºä¾‹"
sidebarTitle: "ç¤ºä¾‹"
description: "æŒ‰å¤æ‚åº¦çº§åˆ«ç»„ç»‡çš„å®ç”¨é’©å­ç¤ºä¾‹ - ä»åˆå­¦è€…åˆ°é«˜çº§æ¨¡å¼"
---

æ­¤é¡µé¢æä¾›å®Œæ•´çš„ã€ç”Ÿäº§å°±ç»ªçš„é’©å­ç¤ºä¾‹ï¼ŒæŒ‰æŠ€èƒ½çº§åˆ«ç»„ç»‡ã€‚æ¯ä¸ªç¤ºä¾‹åŒ…æ‹¬å®Œæ•´çš„å·¥ä½œä»£ç ã€è¯¦ç»†è§£é‡Šä»¥åŠä½•æ—¶ä½¿ç”¨æ¯ç§æ¨¡å¼çš„æŒ‡å¯¼ã€‚

## å¦‚ä½•ä½¿ç”¨è¿™äº›ç¤ºä¾‹

æ¯ä¸ªç¤ºä¾‹è®¾è®¡ä¸ºï¼š
- **å³å¤åˆ¶å³ç”¨**ï¼šç›´æ¥ä½¿ç”¨æˆ–ä½œä¸ºèµ·ç‚¹
- **æ•™è‚²æ€§**ï¼šé€šè¿‡é€’è¿›çš„å¤æ‚æ€§å­¦ä¹ é’©å­æ¦‚å¿µ
- **å®ç”¨æ€§**ï¼šè§£å†³çœŸå®çš„å¼€å‘å·¥ä½œæµæŒ‘æˆ˜

æ ¹æ®ä½ çš„ç»éªŒçº§åˆ«é€‰æ‹©ç¤ºä¾‹ï¼Œå¹¶é€æ­¥å‘å±•åˆ°æ›´é«˜çº§çš„æ¨¡å¼ã€‚

---

## åˆå­¦è€…ç¤ºä¾‹

éå¸¸é€‚åˆå¼€å§‹ä½¿ç”¨é’©å­ã€‚è¿™äº›ç¤ºä¾‹ä½¿ç”¨ç®€å•çš„é€»è¾‘æ¼”ç¤ºæ ¸å¿ƒæ¦‚å¿µã€‚

### 1. é¡¹ç›®ç±»å‹æ£€æµ‹

**é’©å­ï¼š** `TaskStart`

```bash
#!/usr/bin/env bash
# é¡¹ç›®ç±»å‹æ£€æµ‹é’©å­
# 
# æ¦‚è¿°ï¼šåœ¨ä»»åŠ¡å¼€å§‹æ—¶è‡ªåŠ¨æ£€æµ‹é¡¹ç›®ç±»å‹ï¼Œå¹¶å°†ç›¸å…³çš„
# ç¼–ç æ ‡å‡†å’Œæœ€ä½³å®è·µæ³¨å…¥åˆ° AI ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™æœ‰åŠ©äº Cline ç†è§£
# ä½ çš„é¡¹ç›®ç»“æ„å¹¶ä»ä¸€å¼€å§‹åº”ç”¨é€‚å½“çš„çº¦å®šã€‚
#
# æ¼”ç¤ºï¼šåŸºæœ¬çš„é’©å­è¾“å…¥/è¾“å‡ºã€æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ã€æ¡ä»¶é€»è¾‘ï¼Œ
# ä»¥åŠå¼•å¯¼ AI è¡Œä¸ºçš„ä¸Šä¸‹æ–‡æ³¨å…¥ã€‚

input=$(cat)

# è¯»å–åŸºæœ¬ JSON ç»“æ„å¹¶æ£€æµ‹é¡¹ç›®ç±»å‹
context=""

# æ£€æŸ¥ä¸åŒçš„é¡¹ç›®æŒ‡ç¤ºå™¨
if [[ -f "package.json" ]]; then
  if grep -q "react" package.json; then
    context="PROJECT_TYPE: æ£€æµ‹åˆ° React åº”ç”¨ç¨‹åºã€‚éµå¾ªåŸºäºç»„ä»¶çš„æ¶æ„å¹¶ä½¿ç”¨å‡½æ•°ç»„ä»¶ã€‚"
  elif grep -q "express" package.json; then
    context="PROJECT_TYPE: æ£€æµ‹åˆ° Express.js APIã€‚éµå¾ª RESTful æ¨¡å¼å’Œé€‚å½“çš„ä¸­é—´ä»¶ç»“æ„ã€‚"
  else
    context="PROJECT_TYPE: æ£€æµ‹åˆ° Node.js é¡¹ç›®ã€‚ä½¿ç”¨é€‚å½“çš„ npm è„šæœ¬å’Œä¾èµ–ç®¡ç†ã€‚"
  fi
elif [[ -f "requirements.txt" ]] || [[ -f "pyproject.toml" ]]; then
  context="PROJECT_TYPE: æ£€æµ‹åˆ° Python é¡¹ç›®ã€‚éµå¾ª PEP 8 æ ‡å‡†å¹¶ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒã€‚"
elif [[ -f "Cargo.toml" ]]; then
  context="PROJECT_TYPE: æ£€æµ‹åˆ° Rust é¡¹ç›®ã€‚éµå¾ª Rust çº¦å®šå¹¶ä½¿ç”¨é€‚å½“çš„é”™è¯¯å¤„ç†ã€‚"
elif [[ -f "go.mod" ]]; then
  context="PROJECT_TYPE: æ£€æµ‹åˆ° Go é¡¹ç›®ã€‚éµå¾ª Go çº¦å®šå¹¶ä½¿ç”¨é€‚å½“çš„åŒ…ç»“æ„ã€‚"
fi

# è¿”å›ä¸Šä¸‹æ–‡ä»¥å¼•å¯¼ Cline çš„è¡Œä¸º
if [[ -n "$context" ]]; then
  jq -n --arg ctx "$context" '{"cancel": false, "contextModification": $ctx}'
else
  echo '{"cancel": false}'
fi
```

**å…³é”®æ¦‚å¿µï¼š**
- ä½¿ç”¨ `input=$(cat)` è¯»å–é’©å­è¾“å…¥
- ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥æ£€æµ‹é¡¹ç›®ç±»å‹
- è¿”å›ä¸Šä¸‹æ–‡ä»¥å½±å“ AI è¡Œä¸º
- ä½¿ç”¨ `jq` è¿›è¡ŒåŸºæœ¬ JSON è¾“å‡º

### 2. æ–‡ä»¶æ‰©å±•åéªŒè¯å™¨

**é’©å­ï¼š** `PreToolUse`

```bash
#!/usr/bin/env bash
# æ–‡ä»¶æ‰©å±•åéªŒè¯å™¨é’©å­
#
# æ¦‚è¿°ï¼šé€šè¿‡é˜»æ­¢åˆ›å»º .js å’Œ .jsx æ–‡ä»¶ï¼Œåœ¨ TypeScript é¡¹ç›®ä¸­å¼ºåˆ¶æ‰§è¡Œ
# TypeScript æ–‡ä»¶æ‰©å±•åã€‚è¿™é˜²æ­¢å¼€å‘äººå‘˜åœ¨ä½¿ç”¨ TypeScript æ—¶æ„å¤–
# åˆ›å»º JavaScript æ–‡ä»¶çš„å¸¸è§é”™è¯¯ã€‚
#
# æ¼”ç¤ºï¼šPreToolUse é˜»æ­¢ã€å‚æ•°æå–ã€æ¡ä»¶éªŒè¯ï¼Œ
# ä»¥åŠæä¾›æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯ä»¥å¼•å¯¼ç”¨æˆ·ä½¿ç”¨æ­£ç¡®çš„æ–‡ä»¶æ‰©å±•åã€‚

input=$(cat)

# æå–å·¥å…·ä¿¡æ¯
tool_name=$(echo "$input" | jq -r '.preToolUse.toolName')

# ä»…å¤„ç†æ–‡ä»¶åˆ›å»ºå·¥å…·
if [[ "$tool_name" != "write_to_file" ]]; then
  echo '{"cancel": false}'
  exit 0
fi

# æ£€æŸ¥è¿™æ˜¯å¦æ˜¯ TypeScript é¡¹ç›®
if [[ ! -f "tsconfig.json" ]]; then
  echo '{"cancel": false}'
  exit 0
fi

# ä»å·¥å…·å‚æ•°è·å–æ–‡ä»¶è·¯å¾„
file_path=$(echo "$input" | jq -r '.preToolUse.parameters.path // empty')

if [[ -z "$file_path" ]]; then
  echo '{"cancel": false}'
  exit 0
fi

# åœ¨ TypeScript é¡¹ç›®ä¸­é˜»æ­¢ .js æ–‡ä»¶
if [[ "$file_path" == *.js ]]; then
  echo '{"cancel": true, "errorMessage": "TypeScript é¡¹ç›®ä¸­ä¸å…è®¸ JavaScript æ–‡ä»¶ï¼ˆ.jsï¼‰ã€‚è¯·æ”¹ç”¨ .ts æ‰©å±•åã€‚"}'
  exit 0
fi

# é˜»æ­¢ .jsx æ–‡ä»¶ï¼Œå»ºè®®ä½¿ç”¨ .tsx
if [[ "$file_path" == *.jsx ]]; then
  echo '{"cancel": true, "errorMessage": "TypeScript é¡¹ç›®ä¸­ä¸å…è®¸ JSX æ–‡ä»¶ï¼ˆ.jsxï¼‰ã€‚è¯·æ”¹ç”¨ .tsx æ‰©å±•åã€‚"}'
  exit 0
fi

# ä¸€åˆ‡æ­£å¸¸
echo '{"cancel": false}'
```

**å…³é”®æ¦‚å¿µï¼š**
- æå–å·¥å…·åç§°å’Œå‚æ•°
- åŸºäºé¡¹ç›®çŠ¶æ€çš„æ¡ä»¶é€»è¾‘
- ä½¿ç”¨ `"cancel": true` é˜»æ­¢æ“ä½œ
- æä¾›æœ‰ç”¨çš„é”™è¯¯æ¶ˆæ¯

### 3. åŸºæœ¬æ€§èƒ½ç›‘æ§å™¨

**é’©å­ï¼š** `PostToolUse`

```bash
#!/usr/bin/env bash
# åŸºæœ¬æ€§èƒ½ç›‘æ§å™¨é’©å­
#
# æ¦‚è¿°ï¼šç›‘æ§å·¥å…·æ‰§è¡Œæ—¶é—´å¹¶è®°å½•è¶…è¿‡ 3 ç§’
# é˜ˆå€¼çš„æ“ä½œã€‚è¿™æœ‰åŠ©äºè¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼Œå¹¶å‘ç”¨æˆ·
# æä¾›æœ‰å…³å¯èƒ½å‡æ…¢ Cline æ“ä½œçš„ç³»ç»Ÿèµ„æºé—®é¢˜çš„åé¦ˆã€‚
#
# æ¼”ç¤ºï¼šPostToolUse é’©å­ç”¨æ³•ã€bash ä¸­çš„ç®—æœ¯è¿ç®—ã€ç®€å•æ–‡ä»¶
# è®°å½•ä»¥åŠåŸºäºæ€§èƒ½æŒ‡æ ‡çš„æ¡ä»¶ä¸Šä¸‹æ–‡æ³¨å…¥ã€‚

input=$(cat)

# æå–æ€§èƒ½ä¿¡æ¯
tool_name=$(echo "$input" | jq -r '.postToolUse.toolName')
execution_time=$(echo "$input" | jq -r '.postToolUse.executionTimeMs // 0')
success=$(echo "$input" | jq -r '.postToolUse.success')

# è®°å½•æ…¢æ“ä½œï¼ˆé˜ˆå€¼ï¼š3 ç§’ï¼‰
if (( execution_time > 3000 )); then
  # åˆ›å»ºç®€å•çš„æ—¥å¿—ç›®å½•
  mkdir -p "$HOME/.cline_logs"
  
  # è®°å½•æ…¢æ“ä½œ
  echo "$(date -Iseconds): SLOW OPERATION - $tool_name è€—æ—¶ ${execution_time}ms" >> "$HOME/.cline_logs/performance.log"
  
  # å‘ç”¨æˆ·æä¾›åé¦ˆ
  context="PERFORMANCE: æ“ä½œ $tool_name è€—æ—¶ ${execution_time}msã€‚å¦‚æœè¿™ç§æƒ…å†µç»å¸¸å‘ç”Ÿï¼Œè¯·è€ƒè™‘æ£€æŸ¥ç³»ç»Ÿèµ„æºã€‚"
  jq -n --arg ctx "$context" '{"cancel": false, "contextModification": $ctx}'
else
  echo '{"cancel": false}'
fi
```

**å…³é”®æ¦‚å¿µï¼š**
- å·¥å…·æ‰§è¡Œåå¤„ç†ç»“æœ
- bash ä¸­çš„åŸºæœ¬ç®—æœ¯è¿ç®—
- ç®€å•çš„æ–‡ä»¶è®°å½•
- æ¡ä»¶ä¸Šä¸‹æ–‡æ³¨å…¥

## ä¸­çº§ç¤ºä¾‹

è¿™äº›ç¤ºä¾‹æ¼”ç¤ºæ›´é«˜çº§çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬å¤–éƒ¨å·¥å…·é›†æˆã€æ¨¡å¼åŒ¹é…å’Œç»“æ„åŒ–è®°å½•ã€‚

### 4. ä½¿ç”¨ Linting è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥

**é’©å­ï¼š** `PreToolUse`

```bash
#!/usr/bin/env bash
# ä»£ç è´¨é‡ Linting é’©å­
#
# æ¦‚è¿°ï¼šé›†æˆ ESLint å’Œ Flake8 ä»¥åœ¨å†™å…¥æ–‡ä»¶ä¹‹å‰å¼ºåˆ¶æ‰§è¡Œä»£ç è´¨é‡æ ‡å‡†ã€‚
# å¦‚æœæ£€æµ‹åˆ° linting é”™è¯¯ï¼Œåˆ™é˜»æ­¢æ–‡ä»¶åˆ›å»ºï¼Œç¡®ä¿æ‰€æœ‰ä»£ç ç¬¦åˆè´¨é‡æ ‡å‡†ã€‚
# æ”¯æŒ TypeScriptã€JavaScript å’Œ Python æ–‡ä»¶ã€‚
#
# æ¼”ç¤ºï¼šå¤–éƒ¨å·¥å…·é›†æˆã€ä¸´æ—¶æ–‡ä»¶å¤„ç†ã€æ­£åˆ™è¡¨è¾¾å¼
# æ¨¡å¼åŒ¹é…ä»¥åŠå…·æœ‰å¯æ“ä½œåé¦ˆçš„ç»¼åˆé”™è¯¯æŠ¥å‘Šã€‚

input=$(cat)

tool_name=$(echo "$input" | jq -r '.preToolUse.toolName')

# ä»…å¯¹æ–‡ä»¶å†™å…¥æ“ä½œè¿›è¡Œ lint
if [[ "$tool_name" != "write_to_file" ]]; then
  echo '{"cancel": false}'
  exit 0
fi

file_path=$(echo "$input" | jq -r '.preToolUse.parameters.path // empty')

# è·³è¿‡éä»£ç æ–‡ä»¶
if [[ ! "$file_path" =~ \.(ts|tsx|js|jsx|py|rs)$ ]]; then
  echo '{"cancel": false}'
  exit 0
fi

# ä»å·¥å…·å‚æ•°è·å–æ–‡ä»¶å†…å®¹  
content=$(echo "$input" | jq -r '.preToolUse.parameters.content // empty')

if [[ -z "$content" ]]; then
  echo '{"cancel": false}'
  exit 0
fi

# åˆ›å»ºä¸´æ—¶æ–‡ä»¶ç”¨äº linting
temp_file=$(mktemp)
echo "$content" > "$temp_file"

# æ ¹æ®æ–‡ä»¶æ‰©å±•åè¿è¡Œé€‚å½“çš„ linter
lint_errors=""
if [[ "$file_path" =~ \.(ts|tsx)$ ]] && command -v eslint > /dev/null; then
  lint_output=$(eslint "$temp_file" --format=json 2>/dev/null || true)
  if [[ "$lint_output" != "[]" ]] && [[ -n "$lint_output" ]]; then
    error_count=$(echo "$lint_output" | jq '.[0].errorCount // 0')
    if (( error_count > 0 )); then
      messages=$(echo "$lint_output" | jq -r '.[0].messages[] | "\(.line):\(.column) \(.message)"')
      lint_errors="ESLint errors found:\n$messages"
    fi
  fi
elif [[ "$file_path" =~ \.py$ ]] && command -v flake8 > /dev/null; then
  lint_output=$(flake8 "$temp_file" 2>/dev/null || true)
  if [[ -n "$lint_output" ]]; then
    lint_errors="Flake8 errors found:\n$lint_output"
  fi
fi

# æ¸…ç†
rm -f "$temp_file"

# å¦‚æœå‘ç° linting é”™è¯¯åˆ™é˜»æ­¢
if [[ -n "$lint_errors" ]]; then
  error_message="Code quality check failed. Please fix these issues:\n\n$lint_errors"
  jq -n --arg msg "$error_message" '{"cancel": true, "errorMessage": $msg}'
else
  echo '{"cancel": false}'
fi
```

**å…³é”®æ¦‚å¿µï¼š**
- ä¸´æ—¶æ–‡ä»¶åˆ›å»ºå’Œæ¸…ç†
- å¤–éƒ¨å·¥å…·é›†æˆï¼ˆeslintã€flake8ï¼‰
- ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„å¤æ‚æ¨¡å¼åŒ¹é…
- ç»“æ„åŒ–é”™è¯¯æŠ¥å‘Š

### 5. å®‰å…¨æ‰«æå™¨

**é’©å­ï¼š** `PreToolUse`

```bash
#!/usr/bin/env bash
# å®‰å…¨æ‰«æå™¨é’©å­
#
# æ¦‚è¿°ï¼šåœ¨å†™å…¥æ–‡ä»¶ä¹‹å‰æ‰«ææ–‡ä»¶å†…å®¹ä¸­çš„ç¡¬ç¼–ç å¯†é’¥ï¼ˆAPI å¯†é’¥ã€ä»¤ç‰Œã€å¯†ç ï¼‰ã€‚
# é˜»æ­¢åˆ›å»ºåŒ…å«å¯†é’¥çš„æ–‡ä»¶ï¼Œé™¤äº†åœ¨ .env.example æ–‡ä»¶æˆ–æ–‡æ¡£ç­‰å®‰å…¨ä½ç½®ä¸­ï¼Œ
# é˜²æ­¢å‡­æ®æ³„éœ²ã€‚
#
# æ¼”ç¤ºï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ•°ç»„çš„æ¨¡å¼åŒ¹é…ã€æ–‡ä»¶è·¯å¾„å¼‚å¸¸å¤„ç†ï¼Œ
# ä»¥å®‰å…¨ä¸ºé‡ç‚¹çš„éªŒè¯ï¼Œä»¥åŠé”™è¯¯æ¶ˆæ¯ä¸­çš„æ¸…æ™°ç”¨æˆ·æŒ‡å¯¼ã€‚

input=$(cat)

tool_name=$(echo "$input" | jq -r '.preToolUse.toolName')

# ä»…æ£€æŸ¥æ–‡ä»¶æ“ä½œ
if [[ "$tool_name" != "write_to_file" ]]; then
  echo '{"cancel": false}'
  exit 0
fi

content=$(echo "$input" | jq -r '.preToolUse.parameters.content // empty')
file_path=$(echo "$input" | jq -r '.preToolUse.parameters.path // empty')

# å¦‚æœæ²¡æœ‰å†…å®¹åˆ™è·³è¿‡
if [[ -z "$content" ]]; then
  echo '{"cancel": false}'
  exit 0
fi

# å®šä¹‰å¯†é’¥æ¨¡å¼ï¼ˆä¸ºå¯è¯»æ€§ç®€åŒ–ï¼‰
secrets_found=""

# æ£€æŸ¥ API å¯†é’¥
if echo "$content" | grep -qi "api[_-]*key.*[=:].*['\"][a-z0-9_-]{10,}['\"]"; then
  secrets_found+="- æ£€æµ‹åˆ° API å¯†é’¥æ¨¡å¼\n"
fi

# æ£€æŸ¥ä»¤ç‰Œ
if echo "$content" | grep -qi "token.*[=:].*['\"][a-z0-9_-]{10,}['\"]"; then
  secrets_found+="- æ£€æµ‹åˆ°ä»¤ç‰Œæ¨¡å¼\n"
fi

# æ£€æŸ¥å¯†ç 
if echo "$content" | grep -qi "password.*[=:].*['\"][^'\"]{8,}['\"]"; then
  secrets_found+="- æ£€æµ‹åˆ°å¯†ç æ¨¡å¼\n"
fi

# å…è®¸åœ¨å®‰å…¨æ–‡ä»¶ä¸­ä½¿ç”¨å¯†é’¥
safe_patterns=("\.env\.example$" "\.env\.template$" "/docs/" "\.md$")
is_safe_file=false
for safe_pattern in "${safe_patterns[@]}"; do
  if [[ "$file_path" =~ $safe_pattern ]]; then
    is_safe_file=true
    break
  fi
done

if [[ -n "$secrets_found" ]] && [[ "$is_safe_file" == false ]]; then
  error_message="ğŸ”’ å®‰å…¨è­¦æŠ¥ï¼šåœ¨ $file_path ä¸­æ£€æµ‹åˆ°æ½œåœ¨å¯†é’¥

$secrets_found
è¯·æ”¹ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡ã€‚"

  jq -n --arg msg "$error_message" '{"cancel": true, "errorMessage": $msg}'
else
  echo '{"cancel": false}'
fi
```

**å…³é”®æ¦‚å¿µï¼š**
- æ¨¡å¼æ•°ç»„å’Œè¿­ä»£
- æ–‡ä»¶è·¯å¾„å¼‚å¸¸å¤„ç†  
- ä»¥å®‰å…¨ä¸ºé‡ç‚¹çš„éªŒè¯
- é”™è¯¯æ¶ˆæ¯ä¸­çš„æ¸…æ™°ç”¨æˆ·æŒ‡å¯¼

### 6. Git å·¥ä½œæµåŠ©æ‰‹

**é’©å­ï¼š** `PostToolUse`

```bash
#!/usr/bin/env bash
# Git å·¥ä½œæµåŠ©æ‰‹é’©å­
#
# æ¦‚è¿°ï¼šæ ¹æ®æ–‡ä»¶ç±»å‹å’Œå½“å‰åˆ†æ”¯åˆ†ææ–‡ä»¶ä¿®æ”¹å¹¶æä¾›æ™ºèƒ½çš„ git å·¥ä½œæµå»ºè®®ã€‚
# é¼“åŠ±æœ€ä½³å®è·µï¼Œä¾‹å¦‚ç»„ä»¶çš„åŠŸèƒ½åˆ†æ”¯å’Œæµ‹è¯•æ–‡ä»¶çš„æµ‹è¯•åˆ†æ”¯ï¼Œ
# å¹¶æä¾›å¯æ“ä½œçš„ git å‘½ä»¤ã€‚
#
# æ¼”ç¤ºï¼šGit é›†æˆã€åˆ†æ”¯åˆ†æã€æ–‡ä»¶è·¯å¾„æ¨¡å¼åŒ¹é…ï¼Œ
# ä»¥åŠå¼•å¯¼ç”¨æˆ·é‡‡ç”¨æ›´å¥½ git å®è·µçš„ä¸Šä¸‹æ–‡å»ºè®®ã€‚

input=$(cat)

tool_name=$(echo "$input" | jq -r '.postToolUse.toolName')
success=$(echo "$input" | jq -r '.postToolUse.success')

# ä»…å¤„ç†æˆåŠŸçš„æ–‡ä»¶ä¿®æ”¹
if [[ "$success" != "true" ]] || [[ "$tool_name" != "write_to_file" && "$tool_name" != "replace_in_file" ]]; then
  echo '{"cancel": false}'
  exit 0
fi

# æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦åœ¨ git ä»“åº“ä¸­
if ! git rev-parse --git-dir > /dev/null 2>&1; then
  echo '{"cancel": false}'
  exit 0
fi

file_path=$(echo "$input" | jq -r '.postToolUse.parameters.path // empty')
current_branch=$(git branch --show-current 2>/dev/null || echo "main")

# åˆ†ææ–‡ä»¶ç±»å‹å¹¶å»ºè®®é€‚å½“çš„åˆ†æ”¯å‘½å
context=""
if [[ "$file_path" == *"component"* ]] && [[ "$current_branch" == "main" || "$current_branch" == "master" ]]; then
  component_name=$(basename "$file_path" .tsx .ts .jsx .js)
  context="GIT_WORKFLOW: è€ƒè™‘åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼šgit checkout -b feature/add-${component_name,,}-component"
elif [[ "$file_path" == *"test"* ]] || [[ "$file_path" == *"spec"* ]]; then
  if [[ "$current_branch" == "main" || "$current_branch" == "master" ]]; then
    context="GIT_WORKFLOW: è€ƒè™‘åˆ›å»ºæµ‹è¯•åˆ†æ”¯ï¼šgit checkout -b test/add-tests-$(basename "$(dirname "$file_path")")"
  fi
fi

# æ·»åŠ æš‚å­˜æŒ‡å¯¼
if [[ -n "$context" ]]; then
  context="$context å®Œæˆæ›´æ”¹åï¼Œä½¿ç”¨ 'git add $file_path' è¿›è¡Œæš‚å­˜ä»¥æäº¤ã€‚"
else
  context="GIT_WORKFLOW: æ–‡ä»¶å·²ä¿®æ”¹ï¼š$file_pathã€‚å‡†å¤‡å¥½æäº¤æ—¶ä½¿ç”¨ 'git add $file_path'ã€‚"
fi

jq -n --arg ctx "$context" '{"cancel": false, "contextModification": $ctx}'
```

**å…³é”®æ¦‚å¿µï¼š**
- Git ä»“åº“æ£€æµ‹
- åˆ†æ”¯åˆ†æå’Œå»ºè®®
- æ–‡ä»¶è·¯å¾„åˆ†æä»¥è·å–ä¸Šä¸‹æ–‡
- å¯æ“ä½œçš„ç”¨æˆ·æŒ‡å¯¼

## é«˜çº§ç¤ºä¾‹

è¿™äº›ç¤ºä¾‹å±•ç¤ºå¤æ‚çš„æ¨¡å¼ï¼ŒåŒ…æ‹¬å¤–éƒ¨é›†æˆã€å¼‚æ­¥å¤„ç†å’Œå¤æ‚çš„çŠ¶æ€ç®¡ç†ã€‚

### 7. ç»¼åˆä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨

**é’©å­ï¼š** `TaskComplete`

```bash
#!/usr/bin/env bash
# ç»¼åˆä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨é’©å­
#
# æ¦‚è¿°ï¼šé€šè¿‡ç”ŸæˆåŒ…å«å·¥ä½œåŒºä¿¡æ¯å’Œ git çŠ¶æ€çš„è¯¦ç»† markdown æŠ¥å‘Šæ¥è·Ÿè¸ªä»»åŠ¡å®Œæˆï¼Œ
# å¹¶å¯é€‰æ‹©å‘å¤–éƒ¨ç³»ç»Ÿå‘é€ webhook é€šçŸ¥ã€‚éå¸¸é€‚åˆéœ€è¦å®¡è®¡è·Ÿè¸ªçš„ä¼ä¸šç¯å¢ƒã€‚
#
# æ¼”ç¤ºï¼šå¤æ‚æ•°æ®æå–ã€ç»“æ„åŒ–æŠ¥å‘Šç”Ÿæˆã€markdown
# heredocsã€å¼‚æ­¥ webhook é€šçŸ¥å’Œå¥å£®çš„é”™è¯¯å¤„ç†ã€‚

input=$(cat)

# ä½¿ç”¨é€‚å½“çš„ API å­—æ®µè·¯å¾„æå–ä»»åŠ¡å…ƒæ•°æ®
task_id=$(echo "$input" | jq -r '.taskId')
ulid=$(echo "$input" | jq -r '.taskComplete.taskMetadata.ulid // "unknown"')
completion_time=$(echo "$input" | jq -r '.timestamp')

# åˆ›å»ºå®ŒæˆæŠ¥å‘Šç›®å½•å¹¶è¿›è¡Œé”™è¯¯å¤„ç†
reports_dir="$HOME/.cline_reports"
if [[ ! -d "$(dirname "$reports_dir")" ]]; then
  echo '{"cancel": false, "errorMessage": "æ— æ³•è®¿é—®ä¸»ç›®å½•"}' 
  exit 0
fi
mkdir -p "$reports_dir" || exit 0

# ç”Ÿæˆå®‰å…¨ã€å”¯ä¸€çš„æŠ¥å‘Šæ–‡ä»¶å
safe_task_id=$(echo "$task_id" | tr -cd '[:alnum:]_-' | head -c 50)
report_file="$reports_dir/completion_$(date +%Y%m%d_%H%M%S)_${safe_task_id}.md"

# æ”¶é›†å…¨é¢çš„å·¥ä½œåŒºä¿¡æ¯
git_branch=$(git branch --show-current 2>/dev/null || echo "No git repository")
git_status_count=$(git status --porcelain 2>/dev/null | wc -l || echo "0")
project_name=$(basename "$PWD")

# ç”Ÿæˆè¯¦ç»†çš„å®ŒæˆæŠ¥å‘Š
cat > "$report_file" << EOF
# Cline ä»»åŠ¡å®ŒæˆæŠ¥å‘Š

**ä»»åŠ¡ IDï¼š** $task_id  
**ULIDï¼š** $ulid  
**å®Œæˆæ—¶é—´ï¼š** $(date -Iseconds)  
**å®Œæˆæ—¶é—´ï¼š** $completion_time

## å·¥ä½œåŒºä¿¡æ¯
- **é¡¹ç›®ï¼š** $project_name
- **Git åˆ†æ”¯ï¼š** $git_branch
- **ä¿®æ”¹çš„æ–‡ä»¶ï¼š** $git_status_count

## å®ŒæˆçŠ¶æ€
âœ… ä»»åŠ¡æˆåŠŸå®Œæˆ

## åç»­æ­¥éª¤
- å®¡æŸ¥åœ¨æ­¤ä»»åŠ¡æœŸé—´æ‰€åšçš„æ›´æ”¹
- å¦‚æœé€‚å½“ï¼Œè€ƒè™‘æäº¤æ›´æ”¹  
- è¿è¡Œæµ‹è¯•ä»¥éªŒè¯åŠŸèƒ½
EOF

# å¦‚æœé…ç½®äº†ï¼Œå‘é€ webhook é€šçŸ¥
webhook_url="${COMPLETION_WEBHOOK_URL:-}"
if [[ -n "$webhook_url" ]]; then
  payload=$(jq -n \
    --arg task_id "$task_id" \
    --arg ulid "$ulid" \
    --arg workspace "$project_name" \
    --arg timestamp "$completion_time" \
    '{
      event: "task_completed",
      task_id: $task_id,
      ulid: $ulid,
      workspace: $workspace,
      timestamp: $timestamp
    }')
  
  # åœ¨åå°å‘é€é€šçŸ¥å¹¶è®¾ç½®è¶…æ—¶
  (curl -X POST \
    -H "Content-Type: application/json" \
    -d "$payload" \
    "$webhook_url" \
    --max-time 5 \
    --silent > /dev/null 2>&1) &
fi

context="TASK_COMPLETED: âœ… ä»»åŠ¡ $task_id æˆåŠŸå®Œæˆã€‚æŠ¥å‘Šå·²ä¿å­˜åˆ°ï¼š$(basename "$report_file")"
jq -n --arg ctx "$context" '{"cancel": false, "contextModification": $ctx}'
```

**å…³é”®æ¦‚å¿µï¼š**
- å¤æ‚æ•°æ®æå–å’ŒéªŒè¯
- ç»“æ„åŒ–æŠ¥å‘Šç”Ÿæˆ
- å¼‚æ­¥ webhook é€šçŸ¥
- é”™è¯¯å¤„ç†å’Œèµ„æºç®¡ç†

### 8. æ™ºèƒ½ç”¨æˆ·è¾“å…¥å¢å¼ºå™¨  

**é’©å­ï¼š** `UserPromptSubmit`

```bash
#!/usr/bin/env bash
# æ™ºèƒ½ç”¨æˆ·è¾“å…¥å¢å¼ºå™¨é’©å­
#
# æ¦‚è¿°ï¼šåˆ†æç”¨æˆ·æç¤ºä»¥æ£€æµ‹æ½œåœ¨çš„æœ‰å®³å‘½ä»¤ï¼Œè®°å½•ç”¨æˆ·
# æ´»åŠ¨ä»¥è¿›è¡Œåˆ†æï¼Œå¹¶æ ¹æ®æç¤ºå…³é”®å­—æ™ºèƒ½åœ°æ³¨å…¥é¡¹ç›®å’Œ git ä¸Šä¸‹æ–‡ã€‚
# åœ¨å¢å¼º AI å“åº”ç›¸å…³ä¸Šä¸‹æ–‡çš„åŒæ—¶æä¾›å®‰å…¨ä¿æŠ¤ã€‚
#
# æ¼”ç¤ºï¼šUserPromptSubmit é’©å­ç”¨æ³•ã€å¤šæ¨¡å¼å®‰å…¨éªŒè¯ã€ä»æç¤ºä¸­
# æ™ºèƒ½ä¸Šä¸‹æ–‡æ£€æµ‹ã€ç»“æ„åŒ– JSON è®°å½•ä»¥åŠåŠ¨æ€å»ºè®®ç”Ÿæˆã€‚

input=$(cat)

user_prompt=$(echo "$input" | jq -r '.userPromptSubmit.prompt')
task_id=$(echo "$input" | jq -r '.taskId')
user_id=$(echo "$input" | jq -r '.userId')

# è®°å½•ç”¨æˆ·æ´»åŠ¨ä»¥è¿›è¡Œåˆ†æ
activity_log="$HOME/.cline_user_activity/$(date +%Y-%m-%d).log"
mkdir -p "$(dirname "$activity_log")"

activity_entry=$(jq -n \
  --arg timestamp "$(date -Iseconds)" \
  --arg task_id "$task_id" \
  --arg user_id "$user_id" \
  --arg prompt_length "${#user_prompt}" \
  '{
    timestamp: $timestamp,
    task_id: $task_id,
    user_id: $user_id,
    prompt_length: ($prompt_length | tonumber),
    workspace: env.PWD
  }')

echo "$activity_entry" >> "$activity_log"

context_modifications=""
cancel_request=false

# å®‰å…¨éªŒè¯
harmful_patterns=("rm -rf" "delete.*all" "format.*drive" "sudo.*passwd")
for pattern in "${harmful_patterns[@]}"; do
  if echo "$user_prompt" | grep -qi "$pattern"; then
    cancel_request=true
    error_message="ğŸš¨ å®‰å…¨è­¦æŠ¥ï¼šæ£€æµ‹åˆ°æ½œåœ¨çš„æœ‰å®³å‘½ä»¤ã€‚è¯·å®¡æŸ¥ä½ çš„è¯·æ±‚ã€‚"
    break
  fi
done

# æ™ºèƒ½ä¸Šä¸‹æ–‡å¢å¼º
if [[ "$cancel_request" == false ]]; then
  # æ£€æµ‹é¡¹ç›®ä¸Šä¸‹æ–‡
  if echo "$user_prompt" | grep -qi "file\|directory\|folder"; then
    if [[ -f "package.json" ]]; then
      project_name=$(jq -r '.name // "unknown"' package.json 2>/dev/null)
      context_modifications+="PROJECT_CONTEXT: æ­£åœ¨ Node.js é¡¹ç›® '$project_name' ä¸­å·¥ä½œã€‚ "
    elif [[ -f "requirements.txt" ]]; then
      context_modifications+="PROJECT_CONTEXT: æ­£åœ¨ Python é¡¹ç›®ä¸­å·¥ä½œã€‚ "
    fi
  fi
  
  # Git ä¸Šä¸‹æ–‡å¢å¼º
  if echo "$user_prompt" | grep -qi "git\|commit\|branch" && git rev-parse --git-dir > /dev/null 2>&1; then
    current_branch=$(git branch --show-current 2>/dev/null)
    uncommitted=$(git status --porcelain | wc -l)
    context_modifications+="GIT_CONTEXT: åœ¨åˆ†æ”¯ '$current_branch' ä¸Šï¼Œæœ‰ $uncommitted ä¸ªæœªæäº¤çš„æ›´æ”¹ã€‚ "
  fi
  
  # å·¥å…·å»ºè®®
  if echo "$user_prompt" | grep -qi "search.*code\|find.*function"; then
    context_modifications+="SUGGESTION: è€ƒè™‘ä½¿ç”¨ search_files å·¥å…·è¿›è¡Œä»£ç æ¢ç´¢ã€‚ "
  fi
fi

# è¿”å›å“åº”
if [[ "$cancel_request" == true ]]; then
  jq -n --arg msg "$error_message" '{"cancel": true, "errorMessage": $msg}'
else
  if [[ -n "$context_modifications" ]]; then
    jq -n --arg ctx "$context_modifications" '{"cancel": false, "contextModification": $ctx}'
  else
    echo '{"cancel": false}'
  fi
fi
```

**å…³é”®æ¦‚å¿µï¼š**
- ç”¨æˆ·äº¤äº’åˆ†æå’Œè®°å½•
- å¤šæ¨¡å¼å®‰å…¨éªŒè¯
- æ™ºèƒ½ä¸Šä¸‹æ–‡æ£€æµ‹
- åŠ¨æ€å»ºè®®ç”Ÿæˆ

### 9. å¤šæœåŠ¡é›†æˆä¸­å¿ƒ

**é’©å­ï¼š** `PostToolUse`

```bash
#!/usr/bin/env bash
# å¤šæœåŠ¡é›†æˆä¸­å¿ƒé’©å­
#
# æ¦‚è¿°ï¼šæŒ‰ç±»å‹ï¼ˆä¾èµ–é¡¹ã€CI/CDã€å‰ç«¯ã€åç«¯ã€æµ‹è¯•ï¼‰æ£€æµ‹æ–‡ä»¶ä¿®æ”¹ï¼Œ
# å¹¶å‘ Slack å’Œ CI/CD ç³»ç»Ÿç­‰å¤šä¸ªå¤–éƒ¨æœåŠ¡å‘é€å¼‚æ­¥ webhook é€šçŸ¥ã€‚
# å®ç° Cline æ“ä½œä¸ä¼ä¸šå·¥ä½œæµçš„æ— ç¼é›†æˆã€‚
#
# æ¼”ç¤ºï¼šä½¿ç”¨å…³è”æ•°ç»„çš„é«˜çº§æ¨¡å¼åŒ¹é…ã€å¤šæœåŠ¡ webhook
# ç¼–æ’ã€å¼‚æ­¥åå°å¤„ç†å’Œä¼ä¸šé€šçŸ¥æ¨¡å¼ã€‚

input=$(cat)

tool_name=$(echo "$input" | jq -r '.postToolUse.toolName')
success=$(echo "$input" | jq -r '.postToolUse.success')
file_path=$(echo "$input" | jq -r '.postToolUse.parameters.path // empty')

# ä»…å¤„ç†æˆåŠŸçš„æ–‡ä»¶æ“ä½œ
if [[ "$success" != "true" ]] || [[ "$tool_name" != "write_to_file" && "$tool_name" != "replace_in_file" ]]; then
  echo '{"cancel": false}'
  exit 0
fi

# å®šä¹‰å·¥ä½œæµè§¦å‘å™¨
declare -A triggers=(
  ["package\\.json|yarn\\.lock"]="dependencies"
  ["\\.github/workflows/"]="ci_cd"
  ["src/.*component"]="frontend"
  ["api/.*\\.(ts|js)"]="backend"
  [".*\\.(test|spec)\\."]="testing"
)

# ç¡®å®šè§¦å‘çš„å·¥ä½œæµ
triggered_workflows=""
for pattern in "${!triggers[@]}"; do
  if [[ "$file_path" =~ $pattern ]]; then
    workflow_type="${triggers[$pattern]}"
    triggered_workflows+="$workflow_type "
  fi
done

context="WORKFLOW: æ–‡ä»¶å·²ä¿®æ”¹ï¼š$file_path"

if [[ -n "$triggered_workflows" ]]; then
  # Slack é€šçŸ¥ï¼ˆå¼‚æ­¥ï¼‰
  slack_webhook="${SLACK_WEBHOOK_URL:-}"
  if [[ -n "$slack_webhook" ]]; then
    slack_payload=$(jq -n \
      --arg file "$file_path" \
      --arg workflows "$triggered_workflows" \
      --arg workspace "$(basename "$PWD")" \
      '{
        text: ("ğŸ”§ Cline modified `" + $file + "` in " + $workspace),
        color: "good",
        fields: [{
          title: "Triggered Workflows",
          value: $workflows,
          short: true
        }]
      }')
    
    (curl -X POST -H "Content-Type: application/json" -d "$slack_payload" "$slack_webhook" --max-time 5 --silent > /dev/null 2>&1) &
  fi

  # CI/CD webhookï¼ˆå¼‚æ­¥ï¼‰  
  ci_webhook="${CI_WEBHOOK_URL:-}"
  if [[ -n "$ci_webhook" ]]; then
    ci_payload=$(jq -n \
      --arg file "$file_path" \
      --arg workflows "$triggered_workflows" \
      '{
        event: "file_modified",
        file_path: $file,
        workflows: ($workflows | split(" "))
      }')
    
    (curl -X POST -H "Content-Type: application/json" -d "$ci_payload" "$ci_webhook" --max-time 5 --silent > /dev/null 2>&1) &
  fi

  context+=" è§¦å‘çš„å·¥ä½œæµï¼š$triggered_workflowsã€‚å·²å‘é…ç½®çš„æœåŠ¡å‘é€é€šçŸ¥ã€‚"
fi

jq -n --arg ctx "$context" '{"cancel": false, "contextModification": $ctx}'
```

**å…³é”®æ¦‚å¿µï¼š**
- å¤šæœåŠ¡é›†æˆæ¨¡å¼
- å¼‚æ­¥ webhook ç¼–æ’  
- å¤æ‚çš„å·¥ä½œæµæ£€æµ‹
- ä¼ä¸šé€šçŸ¥ç³»ç»Ÿ

## ä½¿ç”¨æç¤º

### è¿è¡Œå¤šä¸ªé’©å­

ä½ å¯ä»¥é€šè¿‡ä¸ºæ¯ç§é’©å­ç±»å‹åˆ›å»ºå•ç‹¬æ–‡ä»¶æ¥ä¸€èµ·ä½¿ç”¨å¤šä¸ªé’©å­ï¼š

```bash
# åˆ›å»ºé’©å­ç›®å½•
mkdir -p .clinerules/hooks

# åˆ›å»ºå¤šä¸ªé’©å­
touch .clinerules/hooks/PreToolUse
touch .clinerules/hooks/PostToolUse
touch .clinerules/hooks/TaskStart

# ä½¿å®ƒä»¬å¯æ‰§è¡Œ
chmod +x .clinerules/hooks/*
```

### ç¯å¢ƒé…ç½®

ä¸ºå¤–éƒ¨é›†æˆè®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
# æ·»åŠ åˆ°ä½ çš„ .bashrc æˆ– .zshrc
export SLACK_WEBHOOK_URL="https://hooks.slack.com/services/..."
export JIRA_URL="https://yourcompany.atlassian.net"
export JIRA_USER="your-email@company.com"
export JIRA_TOKEN="your-api-token"
export CI_WEBHOOK_URL="https://your-ci-system.com/hooks/cline"
```

### æµ‹è¯•ä½ çš„é’©å­

é€šè¿‡æ¨¡æ‹Ÿå…¶è¾“å…¥æ¥æ‰‹åŠ¨æµ‹è¯•é’©å­ï¼š

```bash
# æµ‹è¯• PreToolUse é’©å­
echo '{
  "clineVersion": "1.0.0",
  "hookName": "PreToolUse",
  "timestamp": "2024-01-01T12:00:00Z",
  "taskId": "test",
  "workspaceRoots": ["/path/to/workspace"],
  "userId": "test-user",
  "preToolUse": {
    "toolName": "write_to_file",
    "parameters": {
      "path": "test.js",
      "content": "console.log(\"test\");"
    }
  }
}' | .clinerules/hooks/PreToolUse
```

è¿™äº›ç¤ºä¾‹ä¸ºåœ¨ä½ çš„å¼€å‘å·¥ä½œæµä¸­å®ç°é’©å­æä¾›äº†åšå®çš„åŸºç¡€ã€‚æ ¹æ®ä½ çš„ç‰¹å®šéœ€æ±‚ã€å·¥å…·å’Œé›†æˆè¿›è¡Œè‡ªå®šä¹‰ã€‚
