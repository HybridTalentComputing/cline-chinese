---
title: "上下文管理"
description: "掌握上下文管理以释放 Cline 的全部潜力"
---

<Info>
**快速参考**

- **上下文** = Cline 对你的项目了解的所有信息
- **上下文窗口** = Cline 一次可以处理的最大信息量（因模型而异）
- **Token** = 文本测量单位（约 3/4 个英语单词）
- **自动管理** = Cline 通过焦点链和自动压缩自动处理上下文
</Info>

## 什么是上下文管理？

上下文管理是 Cline 在整个对话中保持对项目理解的方式。把它想象成你和 Cline 之间的共享记忆 - 包含代码、决策、需求和进度。

<Frame caption="上下文就像一个共享工作区，Cline 在其中构建对你的项目的理解">
	<img
		src="https://storage.googleapis.com/cline_public_images/docs/assets/image%20(2).png"
		alt="上下文可视化显示总上下文和上下文窗口之间的关系"
		/>
</Frame>

### 上下文的三个层次

1. **即时上下文** - 当前对话和活动文件
2. **项目上下文** - 你的代码库、结构和模式
3. **持久上下文** - 记忆库、.clinerules 和文档

## 了解上下文窗口

每个 AI 模型都有一个**上下文窗口** - 它可以在单个对话中处理的最大信息量。这以 Token 为单位进行测量：

### 按模型的 Token 限制

| 模型 | 上下文窗口 | 有效限制* | 最适合 |
|-------|---------------|-----------------|----------|
| **Claude 3.5 Sonnet** | 200,000 tokens | 150,000 tokens | 复杂任务、大型代码库 |
| **Claude 3.5 Haiku** | 200,000 tokens | 150,000 tokens | 更快的响应、更简单的任务 |
| **GPT-4o** | 128,000 tokens | 100,000 tokens | 通用开发 |
| **Gemini 2.0 Flash** | 1,000,000+ tokens | 400,000 tokens | 非常大的上下文 |
| **DeepSeek v3** | 64,000 tokens | 50,000 tokens | 经济高效的编码 |
| **Qwen 2.5 Coder** | 128,000 tokens | 100,000 tokens | 专门的编码任务 |

*有效限制是最大值的约 75-80%，以获得最佳性能

<Tip>
**Token 数学简单化**
- 1 token ≈ 3/4 个英语单词
- 100 tokens ≈ 75 个单词 ≈ 3-5 行代码
- 10,000 tokens ≈ 7,500 个单词 ≈ ~15 页文本
- 典型源文件：500-2,000 tokens
</Tip>

## Cline 如何构建上下文

构建有效的上下文是让 Cline 真正有用的关键。当你开始任务时，Cline 不会被动地等待信息 - 他主动收集关于你项目的上下文，在需要时提出澄清问题，并实时适应正在发生的事情。这种自动发现、用户引导和动态适应的结合确保 Cline 始终拥有有效解决问题所需的信息。

### 1. 自动上下文收集

当你开始任务时，Cline 主动：

```mermaid
graph LR
    A[任务开始] --> B[扫描项目结构]
    B --> C[识别相关文件]
    C --> D[读取关键组件]
    D --> E[映射依赖项]
    E --> F[构建心理模型]
```

**Cline 自动发现的内容：**
- 项目结构和文件组织
- 导入关系和依赖项
- 代码模式和约定
- 配置文件和设置
- 最近的更改和 git 历史（使用 @git 时）

### 2. 用户引导的上下文

虽然自动发现处理了大量工作，但你控制 Cline 专注于什么。你提供的上下文越具体和相关性，Cline 就越能理解你的需求并提供准确的解决方案。

你通过以下方式增强上下文：
- **@ 提及**文件、文件夹或 URL
- **用自然语言提供要求**
- **分享截图**以获取 UI 上下文
- **通过 .clinerules 或记忆库添加文档**
- **当 Cline 需要澄清时回答问题**

### 3. 动态上下文适应

Cline 在整个对话中动态调整上下文。它考虑请求的复杂性、可用的上下文窗口空间、当前任务进度、错误消息和反馈，以及在对话期间做出的先前决策，以确定在每个步骤中哪些信息最重要。

## 上下文窗口进度条

实时监控你的上下文使用情况：

<Frame caption="上下文窗口条显示输入/输出 token 使用情况">
	<img
		src="https://storage.googleapis.com/cline_public_images/context-bar.png"
		alt="显示 token 使用的上下文窗口进度条"
		/>
</Frame>

### 了解指示器

- ⬆️ **输入 Token**：发送到模型的信息（你的消息 + 上下文）
- ⬇️ **输出 Token**：模型的响应和生成的代码
- ➡️ **缓存 Token**：已处理并重用的 Token（减少成本并提高速度）
- **进度条**：使用的可视化表示
- **百分比**：总容量的当前使用情况

## 自动上下文管理功能

Cline 包含智能系统，可以为你处理上下文：

### 焦点链（默认：开启）

焦点链通过自动待办事项列表保持任务连续性。当你开始任务时，Cline 生成可操作的步骤，并在工作进展时更新它们。即使在自动压缩运行后，这也保持关键上下文可见，让你无需滚动整个对话即可跟踪进度。

[了解更多 →](/features/focus-chain)

### 自动压缩（始终开启）

当上下文使用达到约 80% 时，自动压缩会自动创建对话的全面摘要。这保留所有决策和代码更改，同时为继续工作释放空间。当这种情况发生时，你会看到一条消息。任务无缝继续 - 你不需要做任何事情。

[了解更多 →](/features/auto-compact)

### 上下文截断系统

如果你的对话在自动压缩运行之前接近模型的上下文窗口限制，Cline 的上下文管理器会自动截断对话的较旧部分以防止错误。

系统优先考虑最重要的内容：
- 你的原始任务描述保持不变
- 最近的工具执行及其结果保持完整
- 当前代码状态和活动错误被保留
- 用户-助手消息的逻辑流程得到维护

首先被删除的内容：
- 任务早期冗余的对话历史
- 不再相关的已完成工具输出
- 中间调试步骤
- 已经达到目的的详细解释

这会自动发生。你将继续工作而不会中断，Cline 维持足够的上下文以继续有效解决你的问题。

## 最佳实践

- **具体明确** - 清晰的目标帮助 Cline 理解你的需求
- **策略性地使用 @ 提及** - 引用特定文件而不是整个文件夹
- **监控进度条** - 黄色/红色意味着考虑使用 `/smol` 或 `/newtask`
- **信任自动管理** - 焦点链和自动压缩自动处理复杂性
- **使用记忆库** - 记录持久的模式和约定

## 下一步

<CardGroup cols={2}>
	<Card title="焦点链" icon="link" href="/features/focus-chain">
		了解焦点链如何保持任务连续性
	</Card>
	<Card title="自动压缩" icon="compress" href="/features/auto-compact">
		了解自动对话压缩
	</Card>
	<Card title="记忆库" icon="brain" href="/prompting/cline-memory-bank">
		设置持久项目知识
	</Card>
	<Card title="Cline 规则" icon="gavel" href="/features/cline-rules">
		定义项目特定约定
	</Card>
</CardGroup>
